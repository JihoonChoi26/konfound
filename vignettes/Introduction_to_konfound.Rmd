---
title: "Introduction to konfound"
author: "Joshua Rosenberg, Ran Xu, and Ken Frank"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.height = 5, fig.width = 5, cache = FALSE)
```

# Abstract

`konfound` is an `R` package to easily carry out sensitivity analysis as described in Frank, Maroulis, Duong, and Kelcey (2013) based on Rubin's (1974) causal model. 

# Background

* Background on sensitivity analysis and causal inference
* Background on replacement of cases approach
* Background on correlation based approach

# Loading konfound

```{r, eval = F}
library(konfound)
```

```{r, echo = F}
devtools::load_all(".")
```

# Use of pkonfound()

```{r}
pkonfound(2, .4, 100, 3)
pkonfound(2, .4, 100, 3, to_return = "thresh_plot")
```

```{r, fig.height = 7, fig.width = 7}
pkonfound(2, .4, 100, 3, to_return = "corr_plot")
```

```{r}
pkonfound(.4, 2, 100, 3)
pkonfound(.4, 2, 100, 3, to_return = "thresh_plot")
```

```{r, fig.height = 7, fig.width = 7}
pkonfound(.4, 2, 100, 3, to_return = "corr_plot")
```

# Use of konfound()

### For linear models fit with lm()

```{r}
m1 <- lm(mpg ~ wt + hp, data = mtcars)
m1

konfound(m1, hp)
konfound(m1, test_all = T)
```

### For generalized linear models fit with glm()

Effects for these models are interpreted on the basis of average partial (or marginal) effects (calculated using the margins package).

```{r}
# if forcats is not installed, install it first using install.packages("forcats")
d <- forcats::gss_cat
d$married <- ifelse(d$marital == "Married", 1, 0)

m2 <- glm(married ~ age, data = d, family = binomial(link = "logit"))
konfound(m2, age)
```

# Use of mkonfound()

Here, `df` represents output from a number of past studies. 

```{r, warning = F}
df <- data.frame(unstd_beta = c(2, 10, 1.7, .4, 3.2, 1.0, 2.3, 4.1, .9),
                 std_error = c(.3, 2.9, 1.5, 2, .1, .04, .1, 3, .5),
                 n_obs = c(70, 405, 200, 100, 103, 20, 50, 721, 320),
                 n_covs = c(3, 4, 1, 3, 10, 4, 1, 1, 0))
mkonfound(df)
mkonfound(df, return_plot = TRUE)
```

# References

Frank, K.A., Maroulis, S., Duong, M., and Kelcey, B. 2013. What would it take to Change an Inference?: Using Rubinâ€™s Causal Model to Interpret the Robustness of Causal Inferences. Education, Evaluation and Policy Analysis.  Vol 35: 437-460. https://msu.edu/~kenfrank/What%20would%20it%20take%20to%20Change%20an%20Inference%20published.docx
 
Frank, K.A., Gary Sykes, Dorothea Anagnostopoulos, Marisa Cannata, Linda Chard, Ann Krause, Raven McCrory. 2008. Extended Influence: National Board Certified Teachers as Help Providers. Education, Evaluation, and Policy Analysis. Vol 30(1): 3-30. https://msu.edu/~kenfrank/papers/Does%20NBPTS%20Certification%20Affect%20the%20Number%20of%20Colleagues%20a%20Teacher%20Helps%20with%20Instructional%20Matters%20acceptance%20version%202.doc
 
Frank, K. A. and Min, K. 2007. Indices of Robustness for Sample Representation. Sociological Methodology. Vol 37, 349-392. https://msu.edu/~kenfrank/papers/INDICES%20OF%20ROBUSTNESS%20TO%20CONCERNS%20REGARDING%20THE%20REPRESENTATIVENESS%20OF%20A%20SAMPLE.doc *co first authors.
 
Frank, K. 2000. "Impact of a Confounding Variable on the Inference of a Regression Coefficient." Sociological Methods and Research, 29(2), 147-194 https://msu.edu/~kenfrank/papers/impact%20of%20a%20confounding%20variable.pdf